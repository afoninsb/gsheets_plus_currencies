# gsheets_plus_currencies

# Технологии

Python 3.10, Django 4.1.7, djangorestframework 3.14.0, drf-yasg 1.21.5, gspread 5.7.2, gunicorn 20.1.0, lxml 4.9.2, psycopg2 2.9.5, python-dotenv 1.0.0, sqlalchemy 2.0.6, Docker, Docker-Compose

# Подготовка к запуску

1. Установить в оперционную систему [Docker](https://docs.docker.com/engine/install/) и [Docker-Compose](https://docs.docker.com/compose/install/)
2. В [Google API Console](https://console.developers.google.com/) настроить приложение для доступа к Google-диску и Google-Таблицам и получить json-файл, содержащий приватный ключ.

**ВНИМАНИЕ! Для проверки тестового задания этот файл нужно скачать с [Google-диска из папки](https://drive.google.com/drive/folders/18oean1fLV34UlhwzGG8A9V5g_1_RnIYa?usp=sharing), расшаренной мною на указанный в задании имейл**

3. С помощью бота [BotFather](https://t.me/BotFather) создать бота и получить его токен
4. Если неизвестен личный Telegram ID, то узнать его с помощью бота [Get My ID](https://t.me/getmyid_bot)
5. С этого Telegram ID войти в бота из п. 3 и активировать его.


# Настройка проекта

Клонируйте проект на свой ПК
```bash
  git clone git@github.com:afoninsb/gsheets_plus_currencies.git
```

## Папки и файлы

1. Зайдите в папку проекта *gsheets_plus_currencies*
2. В папке *gpc/get_data/* создать папку *.conf*
3. Скопировать в созданную папку *gpc/get_data/.conf/* файл с API-ключём Google (см. раздел *"Подготовка к запуску, п.2"*)
4. Переименовать файл *.env.dist* в *.env*

## Переменные

1. Для анализа тестового задания достаточно изменить две переменные в файле *.env*:
   - TOKEN - токен бота, полученный в разделе *"Подготовка к запуску, п.3"*
   - CHAT_ID - ваш личный Telegram ID (см. раздел *"Подготовка к запуску, п.4"*)


# Запуск проекта

1. Зайдите в папку проекта *gsheets_plus_currencies*
2. Запустите окно терминала из неё
3. Отправьте команду:
```bash
  sudo docker-compose up --build
```
4. Когда запустятся все три контейнера запустите ещё одно окно терминала из папки проекта
5. Отправьте команду:
```bash
  sh run.sh
```
При этом произойдёт следующее:
   1) соберутся статические файлы проекта
   2) выполнятся миграции
   3) вы создадите суперюзера Django
   4) запустится python-скрипт *gpc/get_data/main.py* для импорта информации из Google-таблицы в базу данных


# Работа с проектом

## Скрипт импорта информации из Google-таблицы в базу данных

1. Скрипт настроен на постоянную работу с задержкой на 24 часа.
2. Т.к. не было указана конкретная логика по-поводу обновления информации, я решил перед каждым импортом удалять всю информации из базы данных и загружить актуальную

## Backend

Т.к. сделать Frontend на React я не могу, решил сделать API на базе Django и DRF. Фронтенд можно создать, получая информацию с этого API

Методы API - в техническом задании есть скриншот фронтенда, я его проанализировал и сделал вывод, что создание и редактирование данных не предусмотрено. Т.о. сделал два метода: для получения информации об одном заказе и о всех заказах (с их общей суммой)

После запуска проекта:

Документация по API - http://127.0.0.1/api/redoc/

Админпанель Django - http://127.0.0.1/admin/

## Очистка ПК

По окончании изучения проекта, вы можете очистить ваш ПК от созданных артефактов: контейнеров, образов и дисков. Для этого из папки проекта запустите терминал и дайте команду:
```bash
  sh clean.sh
```


# Контакт

Готов ответить на все вопросы по проекту в Телеграм [@afoninsb](https://t.me/afoninsb)
